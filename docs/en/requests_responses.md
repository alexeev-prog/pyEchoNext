# pyEchoNext / Request/Response

---

Request - HTTP request. Response - HTTP response.

## Introduction

In computer science, request-response or request-replica is one of the basic methods used by computers to communicate with each other on a network, in which the first computer sends a request for some data and the second one responds to the request. More specifically, it is a messaging pattern in which a requester sends a request message to a responder system, which receives and processes the request, ultimately returning a message in response. This is similar to a telephone call, in which the caller must wait for the recipient to pick up the phone before anything can be discussed.


noun
    an act of asking politely or formally for something.
        - "a request for information"
    Synonyms: bidding, asking, entreaty, pleading, solicitation, petitioning, supplication, begging, demand, instance

verb
    politely or formally ask for.
        - "he received the information he had requested"
    Synonyms: obtest, impetrate, obsecrate

Synonyms
    noun
        - behest
        - appeal, entreaty, plea, petition, solicitation, supplication, prayer, invocation, application, demand, call, summons, requisition
        - imploration, adjuration, obtestation, impetration, obsecration
        - bidding, asking, entreaty, pleading, solicitation, petitioning, supplication, begging, demand, instance
        - requirement, wish, want, desire, choice, desideratum

    verb
        - ask for, appeal for, call for, seek, solicit, plead for, put in a plea for, pray for, petition, sue for, supplicate for, apply for, put in an application for, put in for, place an order for, put in an order for, order, demand, require, requisition, call on, beg, beseech, entreat, implore, importune, adjure, invite, bid
        - obtest, impetrate, obsecrate

**Request** is a request that contains data for interaction between the client and the API: base URL, endpoint, method to use, headers, etc.

```python

class Request:

"""

This class describes a request.

"""

def __init__(self, environ: dict, settings: Settings):

"""

Constructs a new instance.

:param		environ:  The environ

:type		environ:  dict

"""

self.environ: dict = environ

self.settings: Settings = settings

self.method: str = self.environ["REQUEST_METHOD"]

self.path: str = self.environ["PATH_INFO"]

self.GET: dict = self._build_get_params_dict(self.environ["QUERY_STRING"])

self.POST: dict = self._build_post_params_dict(self.environ["wsgi.input"].read())

self.user_agent: str = self.environ["HTTP_USER_AGENT"]

self.extra: dict = {}

logger.debug(f"New request created: {self.method} {self.path}")

def __getattr__(self, item: Any) -> Union[Any, None]:

"""

Magic method for get attrs (from extra)

:param		item:  The item

:type		item:  Any

:returns:	Item from self.extra or None

:rtype:		Union[Any, None]

"""

return self.extra.get(item, None)

def _build_get_params_dict(self, raw_params: str):

"""

Builds a get parameters dictionary.

:param		raw_params:	 The raw parameters

:type		raw_params:	 str

"""

return parse_qs(raw_params)

def _build_post_params_dict(self, raw_params: bytes):

"""

Builds a post parameters dictionary.

:param		raw_params:	 The raw parameters

:type		raw_params:	 bytes

"""

return parse_qs(raw_params.decode())

```

Request requires the following arguments to create:

+ environ (dictionary) - web environment (generated by gunicorn)

+ settings (pyechonext.config.Settings dataclass object)

Request has the following public attributes:

+ environ (dictionary) - web environment

+ settings (pyechonext.config.Settings dataclass object)

+ method (string) - http method

+ path (string) - path

+ GET (dictionary) - get request parameters

+ POST (dictionary) - post request parameters

+ user_agent (string) - User-Agent

+ extra (dictionary) - additional parameters (for example for middleware)

Request also has the following methods:



+ `__getattr__` - magic descriptor method for getting attributes (to get elements from the extra attribute)

+ `_build_get_params_dict` - private method for parsing get request parameters

+ `_build_post_params_dict` - private method for parsing post request parameters


noun
    a verbal or written answer.
        - "without waiting for a response, she returned to her newspaper"

Synonyms
    noun
        - comeback, clapback
        - answer, reply, acknowledgment, rejoinder, retort, return, riposte, sally, counter
        - comeback
        - reaction, reply, reciprocation, retaliation, feedback

**Response** is a response that contains the data returned by the server, including content, status code, and headers.

```python

class Response:

"""

This dataclass describes a response.

"""

default_content_type: str = "application/json"

default_charset: str = "UTF-8"

unicode_errors: str = "strict"

default_conditional_response: bool = False

default_body_encoding: str = "UTF-8"

def __init__(


noun
    a person's essential being that distinguishes them from others, especially considered as the object of introspection or reflexive action.
        - "our alienation from our true selves"

adjective
    (of a trimming or cover) of the same material and color as the rest of the item.
        - "a dress with self belt"

verb
    self-pollinate; self-fertilize.
        - "a variety that selfs itself loses lots of vigor in the progeny"

combining form
    of or directed toward oneself or itself.
        - "self-hatred"

Examples
    - a dress with self belt

    - language is an aspect of a person's sense of self

    - to love in an unpossessive way implies the total surrender of self

    - guilt can be turned against the self

    - by the end of the round he was back to his old self

    - the only side worth supporting is your own sweet self

    - Paula seemed to be her usual cheerful self

request: Request,

status_code: Optional[int] = 200,

body: Optional[str] = None,

headers: Optional[Dict[str, str]] = {},

content_type: Optional[str] = None,

charset: Optional[str] = None,

):

"""

Constructs a new instance.

:param		status_code:   The status code

:type		status_code:   int

:param		body:		   The body

:type		body:		   str

:param		headers:	   The headers

:type		headers:	   Dict[str, str]

:param		content_type:  The content type

:type		content_type:  str

"""

if status_code == 200:

self.status_code: str = "200 OK"


adverb
    in addition; besides.
        - "anything else you need to know?"

    different; instead.
        - "isn't there anyone else you could ask?"

    short for or else.
        - "keep your mouth shut, else you might contradict my story"

Examples
    - anything else you need to know?

    - I just brought basics—I wasn't sure what else you'd want

    - keep your mouth shut, else you might contradict my story

    - they took songs owned by someone else and used them without permission

    - it's fate, destiny, or whatever else you like to call it

    - they will offer low prices but little else

    - isn't there anyone else you could ask?

    - they moved on to somewhere else

self.status_code: str = str(status_code)

if content_type is None:

self.content_type: str = self.default_content_type


adverb
    in addition; besides.
        - "anything else you need to know?"

    different; instead.
        - "isn't there anyone else you could ask?"

    short for or else.
        - "keep your mouth shut, else you might contradict my story"

Examples
    - keep your mouth shut, else you might contradict my story

    - they will offer low prices but little else

    - isn't there anyone else you could ask?

    - it's fate, destiny, or whatever else you like to call it

    - I just brought basics—I wasn't sure what else you'd want

    - they took songs owned by someone else and used them without permission

    - they moved on to somewhere else

    - anything else you need to know?

self.content_type: str = content_type

if charset is None:

self.charset: str = self.default_charset


adverb
    in addition; besides.
        - "anything else you need to know?"

    different; instead.
        - "isn't there anyone else you could ask?"

    short for or else.
        - "keep your mouth shut, else you might contradict my story"

Examples
    - anything else you need to know?

    - they will offer low prices but little else

    - I just brought basics—I wasn't sure what else you'd want

    - it's fate, destiny, or whatever else you like to call it

    - they moved on to somewhere else

    - isn't there anyone else you could ask?

    - keep your mouth shut, else you might contradict my story

    - they took songs owned by someone else and used them without permission

self.charset: str = charset

if body is not None:

self.body: str = body


adverb
    in addition; besides.
        - "anything else you need to know?"

    different; instead.
        - "isn't there anyone else you could ask?"

    short for or else.
        - "keep your mouth shut, else you might contradict my story"

Examples
    - I just brought basics—I wasn't sure what else you'd want

    - they will offer low prices but little else

    - anything else you need to know?

    - isn't there anyone else you could ask?

    - keep your mouth shut, else you might contradict my story

    - it's fate, destiny, or whatever else you like to call it

    - they moved on to somewhere else

    - they took songs owned by someone else and used them without permission

self.body: str = ""

self._headerslist: list = headers

self._added_headers: list = []

self.request: Request = request

self.extra: dict = {}

self._update_headers()

def __getattr__(self, item: Any) -> Union[Any, None]:

"""

Magic method for get attrs (from extra)

:param		item:  The item

:type		item:  Any

:returns:	Item from self.extra or None

:rtype:		Union[Any, None]

"""

return self.extra.get(item, None)

def _structuring_headers(self, environ):

headers = {

"Host": environ["HTTP_HOST"],

"Accept": environ["HTTP_ACCEPT"],

"User-Agent": environ["HTTP_USER_AGENT"],

}

for name, value in headers.items():

self._headerslist.append((name, value))

for header_tuple in self._added_headers:

self._headerslist.append(header_tuple)

def _update_headers(self) -> None:

"""

Sets the headers by environ.

:param		environ:  The environ

:type		environ:  dict

"""

self._headerslist = [

("Content-Type", f"{self.content_type}; charset={self.charset}"),

("Content-Length", str(len(self.body))),

]

def add_headers(self, headers: List[Tuple[str, str]]):

"""

Adds new headers.

:param		headers:  The headers

:type		headers:  List[Tuple[str, str]]

"""

for header in headers:

self._added_headers.append(header)

def _encode_body(self):

"""

Encodes a body.

"""

if self.content_type.split("/")[-1] == "json":

self.body = str(self.json)


verb
    make an attempt or effort to do something.
        - "he tried to regain his breath"
    Synonyms: attempt, endeavor, make an effort, exert oneself, seek, strive, struggle, do one's best, do one's utmost, do all one can, undertake, aim, set out, take it on oneself, try one's hand at

    subject (someone) to trial.
        - "he was arrested and tried for the murder"

    make severe demands on (a person or a quality, typically patience).
        - "Mary tried everyone's patience to the limit"
    Synonyms: tax, make severe demands on, strain, put a strain on, test, stretch, sap, drain, exhaust, wear out, tire out, weary

    smooth (roughly planed wood) with a plane to give an accurately flat surface.

noun
    an effort to accomplish something; an attempt.
        - "he got his membership card on his third try"
    Synonyms: essay

    an act of touching the ball down behind the opposing goal line, scoring points and entitling the scoring side to a goal kick.

Synonyms
    verb
        - essay
        - assay
        - have a go/shot/crack/stab/bash, give it one's best shot, bend/lean over backwards, bust a gut, do one's damnedest, pull out all the stops, go all out, go for broke, knock oneself out, break one's neck, move heaven and earth, give it a burl, give it a fly
        - attempt, endeavor, make an effort, exert oneself, seek, strive, struggle, do one's best, do one's utmost, do all one can, undertake, aim, set out, take it on oneself, try one's hand at
        - try something on for size, give something a whirl
        - test, try out, check out, put to the test, experiment with, sample, taste, have a taste of, inspect, investigate, examine, appraise, evaluate, assess
        - test, trial, experiment with, pilot, put to the test, put through its paces, put into practice, assess, evaluate
        - adjudicate, consider, hear, pass judgment on, adjudge, examine
        - tax, make severe demands on, strain, put a strain on, test, stretch, sap, drain, exhaust, wear out, tire out, weary

    noun
        - shot, crack, stab, bash, whack
        - attempt, go, effort, endeavor, bid
        - essay

Examples
    - they should give the idea a try

    - I decided to try writing fiction

    - she's not here, but you could try her room

    - they decided to try for another baby

    - he got his membership card on his third try

    - I started to try and untangle the mystery

self.body = self.body.encode("UTF-8")

except AttributeError:

self.body = str(self.body).encode("UTF-8")

def __call__(self, environ: dict, start_response: method) -> Iterable:

"""

Makes the Response object callable.

:param		environ:		 The environ

:type		environ:		 dict

:param		start_response:	 The start response

:type		start_response:	 method

:returns:	response body

:rtype:		Iterable

"""

self._encode_body()

self._update_headers()

self._structuring_headers(environ)

logger.debug(

f"[{environ['REQUEST_METHOD']} {self.status_code}] Run response: {self.content_type}"

)

start_response(status=self.status_code, headers=self._headerslist)

return iter([self.body])


noun
    a thing or things belonging to someone; possessions collectively.
        - "she wanted Oliver and his property out of her house"
    Synonyms: possessions, belongings, things, goods, worldly goods, effects, personal effects, stuff, chattels, movables, resources, assets, valuables, fortune, capital, riches, wealth, holdings, securities, patrimony, personalty, goods and chattels

    an attribute, quality, or characteristic of something.
        - "the property of heat to expand metal at uniform rates"
    Synonyms: quality, attribute, characteristic, feature, power, trait, mark, hallmark

Synonyms
    noun
        - gear, trek
        - possessions, belongings, things, goods, worldly goods, effects, personal effects, stuff, chattels, movables, resources, assets, valuables, fortune, capital, riches, wealth, holdings, securities, patrimony, personalty, goods and chattels
        - building(s), premises, house(s), land, estates, acres, acreage, freehold, leasehold, real property, realty, real estate
        - quality, attribute, characteristic, feature, power, trait, mark, hallmark

Examples
    - the stolen property was not recovered

    - the property of heat to expand metal at uniform rates

    - he's expanding now, buying property

    - she wanted Oliver and his property out of her house

    - rights of property

def json(self) -> dict:

"""

Parse request body as JSON.

:returns:	json body

:rtype:		dict

"""

if self.body:

if self.content_type.split("/")[-1] == "json":

return json.dumps(self.body)


adverb
    in addition; besides.
        - "anything else you need to know?"

    different; instead.
        - "isn't there anyone else you could ask?"

    short for or else.
        - "keep your mouth shut, else you might contradict my story"

Examples
    - they moved on to somewhere else

    - they will offer low prices but little else

    - anything else you need to know?

    - I just brought basics—I wasn't sure what else you'd want

    - keep your mouth shut, else you might contradict my story

    - isn't there anyone else you could ask?

    - they took songs owned by someone else and used them without permission

    - it's fate, destiny, or whatever else you like to call it

return json.dumps(self.body.decode("UTF-8"))


verb
    come or go back to a place or person.
        - "he returned to Canada in the fall"
    Synonyms: go back, come back, get back, arrive back, arrive home, come home, come again

    give, put, or send (something) back to a place or person.
        - "complete the application form and return it to this address"
    Synonyms: restore, put back, replace, reinstate, reinstall

    yield or make (a profit).
        - "the company returned a profit of 4.3 million dollars"
    Synonyms: yield, bring in, earn, make, realize, secure, net, gross, clear, pay out, fetch, pocket

    (of an electorate) elect (a person or party) to office.
        - "the Democrat was returned in the third district"
    Synonyms: elect, vote in, put in power, choose, opt for, select, pick, adopt

    continue (a wall) in a changed direction, especially at right angles.

noun
    an act of coming or going back to a place or activity.
        - "he celebrated his safe return from the war"
    Synonyms: homecoming, travel back

    a profit from an investment.
        - "product areas are being developed to produce maximum returns"
    Synonyms: yield, profit, returns, gain, income, revenue, interest, dividend, percentage

    an official report or statement submitted in response to a formal demand.
        - "census returns"
    Synonyms: statement, report, submission, account, paper, record, file, dossier, write-up, data, information, log, journal, diary, register, summary, document, form

    election to office.
        - "we campaigned for the return of Young and Elkins"

    a key pressed to move the carriage of an electric typewriter back to a fixed position.

    a part receding from the line of the front, for example the side of a house or of a window opening.

Synonyms
    verb
        - go back, come back, get back, arrive back, arrive home, come home, come again
        - recrudesce
        - happen again, recur, reoccur, occur again, be repeated, repeat (itself), come around (again), reappear, appear again, flare up
        - give back, send back, hand back, take back, carry back, pay back, repay, remit
        - restore, put back, replace, reinstate, reinstall
        - reciprocate, requite, feel/give in return, repay, send/give in response, give back, match, equal, wish someone the same
        - answer, reply, respond, say in response, acknowledge, counter, rejoin, riposte, retort, retaliate, hurl back, fling back, snap back, round on someone, come back
        - hit back, send back, throw back
        - deliver, bring in, hand down, render, submit, announce, pronounce, proclaim
        - yield, bring in, earn, make, realize, secure, net, gross, clear, pay out, fetch, pocket
        - elect, vote in, put in power, choose, opt for, select, pick, adopt

    noun
        - homecoming, travel back
        - recrudescence, renascence
        - recurrence, reoccurrence, repeat, rerun, repetition, reappearance, flare-up, revival, rebirth, renaissance, resurrection, reawakening, re-emergence, resurgence
        - reinstalment
        - giving back, handing back, replacement, restoration, reinstatement, reinstallation, restitution
        - returned item, unsold item, unwanted item/ticket, reject, exchange
        - bunce
        - yield, profit, returns, gain, income, revenue, interest, dividend, percentage
        - statement, report, submission, account, paper, record, file, dossier, write-up, data, information, log, journal, diary, register, summary, document, form

Examples
    - we campaigned for the return of Young and Elkins

    - we demand the return of our books and papers

    - he celebrated his safe return from the war

    - the aim is to make the other side unable to return the ball

    - a return flight

    - the designer advocated a return to elegance

    - complete the application form and return it to this address

def __repr__(self):

"""

Returns a unambiguous string representation of the object (for debug...).

:returns:	String representation of the object.

:rtype:		str

"""

return f"<{self.__class__.__name__} at 0x{abs(id(self)):x} {self.status_code}>"

```

Response has the following arguments:

+ request (request class object) - request

+ [optional] status_code (integer value) - response status code

+ [optional] body (string) - response body

+ [optional] headers (dictionary) - response headers

+ [optional] content_type (string) - response content type

+ [optional] charset (string) - response encoding

Response has the following attributes:

+ status_code (string) - status code (default "200 OK")

+ content_type (string) - content type (defaults to default_content_type)

+ charset (string) - encoding (defaults to default_charset)

+ body (string) - body of the answer (defaults to the empty string)

+ `_headerslist` (list) - private list of response headers

+ `_added_headers` (list) - private list of added response headers

+ request (request class object) - request

+ extra (dictionary) - additional parameters

Response has the following methods:

+ `__getattr__` - magic descriptor method for getting attributes (to get elements from the extra attribute)

+ `_structuring_headers` - private method for structuring headers from the web environment

+ `_update_headers` - private method for updating (overwriting) header lists

+ `add_headers` - public method for adding headers

+ `_encode_body` - response body encoding

+ `__call__` - magic method, makes the Response object callable

+ `json` - class property for receiving the response body as json

---

[Contents](./index.md)
